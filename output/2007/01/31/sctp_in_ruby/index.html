<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
  <head>
    <title>yob.id.au: SCTP in Ruby</title>
    <link rel="alternate" type="application/atom+xml" title="Atom" href="/atom/index.xml" />
    <style type="text/css" media="screen">
      * {
        margin: 0;
        padding: 0;
      
        font-family: Georgia, Palatino, Times, 'Times New Roman', sans-serif;
      }
      
      body {
        background: #fff;
      }
      
      a {
        text-decoration: none;
      }
      
      a:link,
      a:visited {
        color: #f30;
      }
      
      a:hover {
        color: #f90;
      }
      
      #main {
        position: absolute;
      
        top: 20px;
        left: 280px;
      
        width: 500px;
      }
      
      #main h1 {
        font-size: 40px;
        font-weight: normal;
      
        line-height: 40px;
      
        padding: 20px 0 20px 0;
      
        letter-spacing: -1px;
      }
      
      #main p {
        margin: 0 0 20px 0;
        
        font-size: 15px;
        
        line-height: 20px;
      }
      
      #main ul {
        padding: 0 0 0 20px;
      }
      
      #main li {
        margin: 0 0 20px 0;
      
        list-style-type: square;
      
        font-size: 15px;
        
        line-height: 20px;
      }
      
      #sidebar {
        position: absolute;
      
        top: 40px;
        left: 20px;
        width: 200px;
      
        padding: 20px 20px 0 0;
      
        border-right: 1px solid #ccc;
      
        text-align: right;
      }
      
      #sidebar h2 {
        text-transform: uppercase;
      
        font-size: 13px;
      
        color: #333;
      
        letter-spacing: 1px;
      
        line-height: 20px;
      }
      
      #sidebar ul {
        list-style-type: none;
      
        margin: 20px 0;
      }
      
      #sidebar li {
        font-size: 14px;
      
        line-height: 20px;
      }
    </style>
  </head>
  <body>
    <div id="main">
      <h1>SCTP in Ruby</h1>
<p><a href="http://www.sctp.org/">SCTP</a> (Stream Control Transmission Protocol) is an alternative to TCP that has been in development for several years and is starting to draw some attention to itself.</p>

<p>Next week work is sending me on a 3 day SCTP training course and I've been having a poke at some sample code so I don't embarass myself when I get there. IBM has a <a href="http://www-128.ibm.com/developerworks/linux/library/l-sctp/index.html">good introduction</a> with some C sample code that worked well enough on my linux 2.6.19 system. </p>

<p>Being the ruby fanboi that I am, I then wanted to try opening an SCTP socket from a ruby script. Without going into SCTP implementation details, there are 2 ways of working with SCTP sockets - via the standard unix socket API, or using libsctp. The libsctp method provides superior functionality, however there don't seem to be any ruby bindings yet.</p>

<p>Using the unix sockets API, and inspiration from a useful <a href="http://en.wikipedia.org/wiki/Datagram_Congestion_Control_Protocol">DCCP</a> <a href="http://linux-net.osdl.org/index.php/DCCP">example</a>, I got some simple SCTP test scripts going.</p>

<p>Server:</p>

<pre><code>require "socket"

# add some additional constants to the Socket class
# to support SCTP
class Socket
  IPPROTO_SCTP = 132
  SOL_SCTP = 132
end

# connection details
SERVER = "127.0.0.1"
PORT =  19000

# start listening on a new socket
server = Socket.new( Socket::AF_INET, Socket::SOCK_STREAM, Socket::IPPROTO_SCTP )
sockaddr = Socket.pack_sockaddr_in( PORT, SERVER )
server.bind(sockaddr)

# wait for clients to connect
while server.listen(1)
  # send some data to the client
  socket, client_addr = server.accept
  socket.puts "Test Data"

  # close the socket
  socket.close
end
</code></pre>

<p>Client:</p>

<pre><code>require "socket"

# add some additional constants to the Socket class
# to support SCTP
class Socket
  IPPROTO_SCTP = 132
  SOL_SCTP = 132
end

# connection details
SERVER = "127.0.0.1"
PORT =  19000

# open a new socket to the server
client = Socket.new( Socket::AF_INET, Socket::SOCK_STREAM, Socket::IPPROTO_SCTP )
sockaddr = Socket.pack_sockaddr_in( PORT, SERVER )
client.connect(sockaddr)

# receive any data the server spits back at us
results = client.recv(1024)

# print the results
puts results.strip

# close the socket
client.close
</code></pre>

<p>To run the scripts, execute them using two terminals on the same machine. Under linux you will need to have the SCTP kernel module loaded, under FreeBSD i'm not sure what's required.</p>

<p>If you're familiar with using TCP sockets in ruby, you'll notice there's almost no difference. All I've done is use Socket::IPPROTO_SCTP instead of 0 for the third argument to Socket.new.</p>

<p>From a feature point of view, these scripts aren't particuarly better than using a TCP socket - to take full advantage of SCTP ruby will need libsctp bindings. Any volunteers?</p>
    </div>
    <div id="sidebar">
      <h2>Pages</h2>
      <ul>
        <li><a href="/">home</a></li>
        <li><a href="/archive">archive</a></li>
        <li><a href="/about">about</a></li>
      </ul>
      <h2>Syndication</h2>
      <ul>
        <li><a href="/atom/index.xml">atom</a></li>
      </ul>
    </div>
  </body>
</html>
