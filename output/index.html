<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
  <head>
    <title>yob.id.au: Home</title>
    <link rel="alternate" type="application/atom+xml" title="Atom" href="/atom/index.xml" />
    <style type="text/css" media="screen">
      * {
        margin: 0;
        padding: 0;
      
        font-family: Georgia, Palatino, Times, 'Times New Roman', sans-serif;
      }
      
      body {
        background: #fff;
      }
      
      a {
        text-decoration: none;
      }
      
      a:link,
      a:visited {
        color: #f30;
      }
      
      a:hover {
        color: #f90;
      }
      
      #main {
        position: absolute;
      
        top: 20px;
        left: 280px;
      
        width: 500px;
      }
      
      #main h1 {
        font-size: 40px;
        font-weight: normal;
      
        line-height: 40px;
      
        padding: 20px 0 20px 0;
      
        letter-spacing: -1px;
      }
      
      #main p {
        margin: 0 0 20px 0;
        
        font-size: 15px;
        
        line-height: 20px;
      }
      
      #main ul {
        padding: 0 0 0 20px;
      }
      
      #main li {
        margin: 0 0 20px 0;
      
        list-style-type: square;
      
        font-size: 15px;
        
        line-height: 20px;
      }
      
      #sidebar {
        position: absolute;
      
        top: 40px;
        left: 20px;
        width: 200px;
      
        padding: 20px 20px 0 0;
      
        border-right: 1px solid #ccc;
      
        text-align: right;
      }
      
      #sidebar h2 {
        text-transform: uppercase;
      
        font-size: 13px;
      
        color: #333;
      
        letter-spacing: 1px;
      
        line-height: 20px;
      }
      
      #sidebar ul {
        list-style-type: none;
      
        margin: 20px 0;
      }
      
      #sidebar li {
        font-size: 14px;
      
        line-height: 20px;
      }
    </style>
  </head>
  <body>
    <div id="main">
      <h1>Home</h1>
<h2>An EventMachine based FTP Server</h2>

<h3>The short version</h3>

<p>I've released a demo of an FTP server for ruby, built on the EventMachine library.</p>

<p>Check it out here: <a href="http://github.com/yob/em-ftpd/tree">http://github.com/yob/em-ftpd/tree</a></p>

<h3>The full version</h3>

<p>Inside our little web 2.0 bubble we all get very excited about shiny things
like REST, web services and open JSON APIs, so it's easy to forget in the
business world with many trading partners and legacy systems, a technology that
works tends to hang around for an awfully long time.</p>

<p>In the supply chain world, the most common way I've encountered for electronic
trading between businesses (submitting orders, receiving invoices, etc) is over
good 'ole <a href="http://tools.ietf.org/rfc/rfc959.txt">FTP</a>.</p>

<p>Yes, it's old and insecure. However it's also simple, well understood, has
plenty of library support and is now embedded in inventory management software
all over the place. You work with what you've got.</p>

<p>For a few years I've maintained a custom FTP server for a client. It accepts
uploaded orders from their customers, translates them to a format the clients
system can understand and saves a copy to a outbox folder. Every few hours the
clients inventory software connects and downloads the orders directly into
their system. It's hardly a high traffic site, maybe 20 transfers a day, all
small text files.</p>

<p>The server was a small ruby daemon, based on the
<a href="http://rubyforge.org/projects/ftpd/">ftpd.rb</a> script published by Chris
Wanstrath, and it performed admirably. Recently I was asked to add some new
features, and I realised over the years the code had turned into 800 lines of
spaghetti. A rewrite was in order.</p>

<p>At the same time a few fellow Australian Rubyist's had been <a href="http://gist.github.com/81523/">playing
around</a> with
<a href="http://rubyeventmachine.com/">EventMachine</a>, a library that claims to help
produce highly scalable network code. Scalability wasn't my issue, but the
examples I could see looked alarmingly clean and simple for network socket
based applications. Best of all, there was no need to involve threads, the arch
nemesis of maintainable code.</p>

<p>Clean and simple was the goal of my rewrite. Bingo.</p>

<p>It took a little while to come to a working solution, mainly because I found
few public EventMachine samples that indicated how to open multiple sockets and
share data between them. It turned out to be possible and my rewritten server
went into production a few days ago.</p>

<p>There was no point asking this client to release their new server as open
source, it's fairly specific to their needs. However I was keen to provide a
public demo of an EventMachine based FTP server, so I've published a new
demo script on github:
<a href="http://github.com/yob/em-ftpd/tree">http://github.com/yob/em-ftpd/tree</a></p>

<p>It's not particularly useful as a real FTP server - it hard codes the
authentication tokens and provides a simulated directory structure. Hopefully
it proves interesting or useful to someone out there though - as a basis for their
own custom FTP server or some other multi-socket protocol.</p>

<hr />

<h2>Outdated Gems Under Rails (the second)</h2>

<p>Last year I <a href="/blog/2008/06/23/outdated_gems_under_rails">shared a short initialiser fragment</a>
for rails that warns you if you've loaded an out of date gem.</p>

<p>It's a non fatal warning, just a reminder that it might be worthwhile upgrading.</p>

<p>I still use the fragment, but have updated it to support rails 2.2+. To use it,
just drop the code into a file in the config/initializers directory of your
app.</p>

<pre><code># *************************************
# A handy initiliser that logs when the loaded version of
# Rails or a gem dependency is out of date. The notice is
# non-fatal (often we want it to be out of date). I often
# forget which version of a gem my apps are using, and 
# don't notice when there is a newer version available.
#
# Only really makes sense on Rails &gt;= 2.1, where initialisers
# and gem dependencies first appeared. Drop this file in
# config/initializers/
#
# James Healy
# 2nd Feb 2009
# *************************************

outdated = []

# *************************************
# check the current version of Rails to see if it's the latest
# *************************************
max_rails_gem = Gem.cache.find_name('rails').map(&amp;:version).map(&amp;:version).max

if max_rails_gem &amp;&amp; (Rails::VERSION::STRING &lt; max_rails_gem)
  outdated &lt;&lt; {:name =&gt; "rails", :loaded =&gt; Rails::VERSION::STRING, :max =&gt; max_rails_gem}
end

# *************************************
# check the current version of all required gems to see if they're the latest
# *************************************
Rails.configuration.gems.each do |gem|
  name = gem.name
  if Rails::VERSION::STRING &gt;= "2.2.0"
    loaded_version = gem.specification.version.to_s
  else
    loaded_version = gem.version.to_s
  end
  max_gem_version = Gem.cache.find_name(name).map(&amp;:version).map(&amp;:version).max

  if max_gem_version &amp;&amp; (loaded_version &lt; max_gem_version)
    outdated &lt;&lt; {:name =&gt; name, :loaded =&gt; loaded_version, :max =&gt; max_gem_version}
  end
end

# *************************************
# print notices 
# *************************************
unless outdated.empty?
  logger = RAILS_DEFAULT_LOGGER
  logger.info 
  logger.info "*******************************"
  outdated.each do |w|
    logger.info "NOTICE: #{w[:name]} version #{w[:loaded]} is not the most recent version of #{w[:name]} available on the system (#{w[:max]})"
  end
  logger.info "*******************************"
  logger.info 
end
</code></pre>

<hr />

<h2>Cuecat</h2>

<p>Why stop at two post on IDs, here's a third.</p>

<p>The <a href="http://en.wikipedia.org/wiki/Cuecat">cuecat</a> is a cheap "wand" style
barcode scanner with an semi-interesting history. The end of the story is that
the company went bust, and they're now fairly cheaply available.</p>

<p>I got one for ~AU$30 from
<a href="http://www.librarything.com/wiki/index.php/CueCat:_ISBNs_and_Barcodes">librarything.com</a>.
I work with books, and real barcode scanners cost an arm and a leg, so I
justified it as a useful work expense.</p>

<p>It's USB, and appears as a keyboard to the computer, so no special drivers are
required. The one hiccup is that it returns an obfuscated code. No worries, the
decoding algorithm is simple and available all over the net.</p>

<p>Here's a ruby version:</p>

<pre><code>gem install cuecat
</code></pre>

<p>Is the code from a cuecat?</p>

<pre><code>puts CueCat.valid?(".C3nZC3nZC3n2CNjXCNz0DxnY.cGen.ENr7CNT3Chz3ENj1CG.")
=&gt; true
</code></pre>

<p>Is the code an obfuscated EAN13?</p>

<pre><code>puts CueCat.ean?(".C3nZC3nZC3n2CNjXCNz0DxnY.cGen.ENr7CNT3Chz3ENj1CG.")
=&gt; true
</code></pre>

<p>Extract more detail from the code:</p>

<pre><code>code = CueCat.new(".C3nZC3nZC3n2CNjXCNz0DxnY.cGen.ENr7CNT3Chz3ENj1CG.")
puts code.code_type
=&gt; "IBN"

puts code.id
=&gt; "000000005112157601"

puts code.value
=&gt; "978184354916"
</code></pre>

<p>API look familiar? It's more or less the same as my oodles of <a href="http://yob.id.au/blog/2008/10/23/barrage_of_new_gems/">other ID
gems</a>.</p>

<hr />

<h2>Barrage of New Gems</h2>

<p>Working for a company that sits in the middle of a supply chain, we deal with a
significant volume of data.</p>

<p>Inbound we have things like customer orders, new product data, invoices and
purchase order status reports from suppliers.</p>

<p>Outbound we have things like purchase orders going to our suppliers, order
confirmations, invoices and new product data going to our customers.</p>

<p>Most of this is electronic and automatic, and is therefore highly dependent on
industry standardised identifiers. In Australia, products are usually
identified with an
<a href="http://en.wikipedia.org/wiki/European_Article_Number">EAN-13</a>, but some of our
US based suppliers are still using
<a href="http://en.wikipedia.org/wiki/Universal_Product_Code">UPC-12</a>.</p>

<p>Australian businesses can be identified by their
<a href="http://en.wikipedia.org/wiki/Australian_Business_Number">ABN</a>, and in the book
industry there is a unique global ID system for businesses called
<a href="http://www.isbn.org/standards/home/isbn/us/san/san-qa.asp">SAN</a>.</p>

<p>To deal with all these IDs in my ruby code, I've put together some very simple
little gems for recognising and validating the various numbers I encounter.</p>

<pre><code>gem install ean13
gem install upc
gem install san
gem install abn
</code></pre>

<p>They're all single file, single class libraries with similar looking APIs, and
operate in a similar way to the ISTC gem I talk about
<a href="http://yob.id.au/blog/2008/10/22/istc/">here</a>.</p>

<p>EAN13:</p>

<pre><code>require 'ean13'

EAN13.valid?("9781843549161")
=&gt; true
EAN13.complete("978184354916")
=&gt; "9781843549161"
</code></pre>

<p>UPC:</p>

<pre><code>require 'upc'

UPC.valid?("028947663058")
=&gt; true
UPC.complete("02894766305")
=&gt; "028947663058"
</code></pre>

<p>SAN: </p>

<pre><code>require 'san'

SAN.valid?("9013725")
=&gt; true
SAN.complete("901372")
=&gt; "9013725"
</code></pre>

<p>ABN:</p>

<pre><code>require 'abn'

ABN.valid?("12042168743")
=&gt; true
</code></pre>

<p>Nothing groundbreaking or exciting, but useful little libraries when you need
to decipher what sort of identifier a number is, and for validating fields in
your models.</p>

<hr />

<h2>International Standard Text Code (ISTC)</h2>

<p>The <a href="http://en.wikipedia.org/wiki/International_Standard_Text_Code">International Standard Text
Code</a> (ISTC)
is a new ISO standard for identifying textual works.</p>

<p>Where an ISBN is used to identify a particular version of a textual work, the
ISTC will be be identical across all versions. There are many versions (and
therefore ISBNs) of Harry Potter and the Half Blood Prince, but there will be a
single ISTC for all of them.</p>

<p>This should make it easier for companies like the one I work for to identify
alternate versions, improve product recommendations and track sales trends.</p>

<p>It's likely we won't start seeing them in the wild until sometime in 2009, but
I've been exploring how they work and have created a rubygem for working with
them.</p>

<p>Installation is easy:</p>

<pre><code>gem install istc
</code></pre>

<p>And so is using it:</p>

<pre><code>ISTC.new("0A9200800000007C").valid?
=&gt; true

ISTC.valid?("0A9200800000007C")
=&gt; true

ISTC.valid?("0A9200800000007B")
=&gt; false

ISTC.complete("0A9200800000007")
=&gt; "0A9200800000007C"

ISTC.new("0A9200800000007").to_s
=&gt; "0A9-2008-00000007-C"
</code></pre>

<ul>
<li>The source is on github: <a href="https://github.com/yob/istc/tree">https://github.com/yob/istc/tree</a></li>
<li>The gem is in my misc gems rubyforge project: <a href="http://rubyforge.org/projects/yob-projects/">http://rubyforge.org/projects/yob-projects/</a></li>
</ul>

<hr />
    </div>
    <div id="sidebar">
      <h2>Pages</h2>
      <ul>
        <li><a href="/">home</a></li>
        <li><a href="/archive">archive</a></li>
        <li><a href="/about">about</a></li>
      </ul>
      <h2>Syndication</h2>
      <ul>
        <li><a href="/atom/index.xml">atom</a></li>
      </ul>
    </div>
  </body>
</html>
